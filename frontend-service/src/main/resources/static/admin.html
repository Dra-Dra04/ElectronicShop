<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Electro - Admin Dashboard</title>

    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <!-- Font Awesome Icon -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Custom Styles -->
    <style>
        body { font-family: 'Montserrat', sans-serif; color: #333; background-color: #FBFBFC; }
        h1, h2, h3, h4, h5, h6 { color: #2B2D42; font-weight: 700; margin: 0 0 10px; }
        a { color: #2B2D42; transition: 0.2s color; }
        a:hover, a:focus { color: #D10024; text-decoration: none; outline: none; }

        /* Electro Theme Colors */
        .primary-color { color: #D10024; }

        /* Header */
        header { padding-bottom: 0; }
        #header { padding-top: 15px; padding-bottom: 15px; background-color: #15161D; }
        #top-header { padding-top: 10px; padding-bottom: 10px; background-color: #1E1F29; }
        .header-links li { display: inline-block; margin-right: 15px; font-size: 12px; }
        .header-links li a { color: #fff; }
        .header-links li i { color: #D10024; margin-right: 5px; }

        .header-logo .logo { display: block; }
        .header-logo .logo img { display: block; }

        /* Admin Section */
        .admin-section { padding-top: 30px; padding-bottom: 30px; }

        /* Sidebar Styling */
        .aside-title { text-transform: uppercase; font-size: 18px; margin-bottom: 30px; border-bottom: 1px solid #E4E7ED; padding-bottom: 10px; }
        .admin-sidebar .nav-pills > li { margin-top: 5px; }
        .admin-sidebar .nav-pills > li > a { border-radius: 0; color: #333; font-weight: 500; border-left: 3px solid transparent; }
        .admin-sidebar .nav-pills > li.active > a,
        .admin-sidebar .nav-pills > li.active > a:focus,
        .admin-sidebar .nav-pills > li.active > a:hover {
            background-color: #fff; color: #D10024; border-left-color: #D10024; box-shadow: 0px 0px 10px rgba(0,0,0,0.05);
        }
        .admin-sidebar .nav-pills > li > a:hover { background-color: #eee; }

        /* Stat Cards */
        .stat-card { background: #fff; padding: 20px; border: 1px solid #E4E7ED; margin-bottom: 20px; position: relative; overflow: hidden; }
        .stat-card .stat-icon { position: absolute; right: 10px; top: 10px; font-size: 40px; color: #e4e7ed; z-index: 1; }
        .stat-card .stat-number { font-size: 24px; font-weight: 700; color: #D10024; position: relative; z-index: 2; margin-bottom: 5px; }
        .stat-card .stat-label { font-size: 14px; text-transform: uppercase; font-weight: 500; position: relative; z-index: 2; }

        /* Buttons & Tables */
        .btn-red { background-color: #D10024; color: #fff; border: none; border-radius: 40px; padding: 10px 20px; font-weight: 700; text-transform: uppercase; font-size: 13px; transition: 0.2s all; cursor: pointer; }
        .btn-red:hover { background-color: #333; color: #fff; }
        .table > thead > tr > th { border-bottom: 2px solid #E4E7ED; font-weight: 700; text-transform: uppercase; font-size: 12px; }
        .table-hover tbody tr:hover { background-color: #f9f9f9; }
        .table { background: #fff; }

        /* Forms */
        .admin-form-group { margin-bottom: 15px; }
        .admin-form-group label { font-weight: 500; margin-bottom: 5px; font-size: 12px; text-transform: uppercase; }
        .input { height: 40px; padding: 0px 15px; border: 1px solid #E4E7ED; background-color: #FFF; width: 100%; }
        textarea.input { padding: 10px 15px; }

        /* Tab Content */
        .tab-content { background: #fff; border: 1px solid #E4E7ED; padding: 30px; min-height: 500px; }
        .section-title { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #E4E7ED; text-transform: uppercase; font-weight: 700; font-size: 18px; }

        /* Footer */
        #footer { background: #15161D; color: #B9BABC; padding-top: 30px; }
        .footer-title { color: #FFF; text-transform: uppercase; font-size: 18px; margin: 0 0 30px; }
        .footer-links li + li { margin-top: 15px; }
        .footer-links li a { color: #B9BABC; }
        .footer-links li a:hover { color: #D10024; }
        .copyright { margin-top: 30px; display: block; font-size: 12px; margin-bottom: 30px;}

        /* Modal Overrides */
        .modal-header { border-bottom: 1px solid #E4E7ED; }
        .modal-footer { border-top: 1px solid #E4E7ED; }
    </style>
</head>
<body>
<!-- HEADER -->
<header>
    <!-- TOP HEADER -->
    <div id="top-header">
        <div class="container">
            <ul class="header-links pull-left">
                <li><a href="#"><i class="fa fa-phone"></i> +021-95-51-84</a></li>
                <li><a href="#"><i class="fa fa-envelope-o"></i> admin@electro.com</a></li>
                <li><a href="#"><i class="fa fa-map-marker"></i> 1734 Stonecoal Road</a></li>
            </ul>
            <ul class="header-links pull-right">
                <li><a href="#"><i class="fa fa-user-secret"></i> Admin Panel</a></li>
                <li><a href="store.html"><i class="fa fa-sign-out"></i> Logout</a></li>
            </ul>
        </div>
    </div>
    <!-- /TOP HEADER -->

    <!-- MAIN HEADER -->
    <div id="header">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">
                <!-- LOGO -->
                <div class="col-md-3">
                    <div class="header-logo">
                        <a href="#" class="logo">
                            <h2 style="color: #FFF; margin-top: 10px;">ELECTRO<span style="color: #D10024;">.</span></h2>
                        </a>
                    </div>
                </div>
                <!-- /LOGO -->

                <!-- Admin Title -->
                <div class="col-md-9 text-right" style="padding-top: 15px;">
                    <h3 style="color: #fff; margin: 0;">ADMIN DASHBOARD</h3>
                </div>
            </div>
            <!-- row -->
        </div>
        <!-- container -->
    </div>
    <!-- /MAIN HEADER -->
</header>
<!-- /HEADER -->

<!-- ADMIN SECTION -->
<div class="section admin-section">
    <!-- container -->
    <div class="container">
        <!-- row -->
        <div class="row">

            <!-- SIDEBAR MENU -->
            <div class="col-md-3">
                <div class="aside">
                    <h3 class="aside-title">Management</h3>
                    <ul class="nav nav-pills nav-stacked admin-sidebar">
                        <li class="active"><a data-toggle="pill" href="#dashboard"><i class="fa fa-tachometer"></i> Dashboard</a></li>
                        <li><a data-toggle="pill" href="#products"><i class="fa fa-cube"></i> Products</a></li>
                        <li><a data-toggle="pill" href="#categories"><i class="fa fa-tags"></i> Categories & Brands</a></li>
                        <li><a data-toggle="pill" href="#orders"><i class="fa fa-shopping-cart"></i> Orders</a></li>
                        <li><a data-toggle="pill" href="#users"><i class="fa fa-users"></i> Users</a></li>
                    </ul>
                </div>
            </div>
            <!-- /SIDEBAR MENU -->

            <!-- MAIN CONTENT -->
            <div class="col-md-9">
                <div class="tab-content">

                    <!-- TAB: DASHBOARD -->
                    <div id="dashboard" class="tab-pane fade in active">
                        <h3 class="section-title">Overview</h3>
                        <div class="row">
                            <div class="col-md-3 col-xs-6">
                                <div class="stat-card">
                                    <i class="fa fa-shopping-cart stat-icon"></i>
                                    <!-- UPDATED: dùng ID để JS set số Orders -->
                                    <div class="stat-number" id="stat-orders">-</div>
                                    <div class="stat-label">Orders</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-xs-6">
                                <div class="stat-card">
                                    <i class="fa fa-dollar stat-icon"></i>
                                    <!-- UPDATED: dùng ID để JS set doanh thu -->
                                    <div class="stat-number" id="stat-revenue">-</div>
                                    <div class="stat-label">Revenue</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-xs-6">
                                <div class="stat-card">
                                    <i class="fa fa-users stat-icon"></i>
                                    <!-- UPDATED: dùng ID để JS set Users -->
                                    <div class="stat-number" id="stat-users">-</div>
                                    <div class="stat-label">Users</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-xs-6">
                                <div class="stat-card">
                                    <i class="fa fa-cube stat-icon"></i>
                                    <!-- UPDATED: dùng ID để JS set Products -->
                                    <div class="stat-number" id="stat-products">-</div>
                                    <div class="stat-label">Products</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: PRODUCTS -->
                    <div id="products" class="tab-pane fade">
                        <div class="row" style="margin-bottom: 20px;">
                            <div class="col-md-6">
                                <h3 class="section-title" style="border:none; margin:0;">Product List</h3>
                            </div>
                            <div class="col-md-6 text-right">
                                <button class="btn-red" data-toggle="modal" data-target="#addProductModal">
                                    <i class="fa fa-plus"></i> Add Product
                                </button>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Actions</th>
                                </tr>
                                </thead>
                                <!-- UPDATED: xoá dữ liệu fake, để tbody trống và JS sẽ fill -->
                                <tbody id="product-table-body">
                                <!-- ADDED: rows will be injected by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- TAB: CATEGORIES & BRANDS -->
                    <div id="categories" class="tab-pane fade">
                        <h3 class="section-title">Categories & Brands Management</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="billing-details">
                                    <div class="section-title">
                                        <h4 class="title">Add New Brand</h4>
                                    </div>
                                    <div class="admin-form-group">
                                        <!-- ADDED: id để sau này gọi API thêm brand -->
                                        <input id="brand-name-input" class="input" type="text" name="brand-name" placeholder="Brand Name">
                                    </div>
                                    <button class="btn-red" id="btn-add-brand"><i class="fa fa-plus"></i> Add Brand</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="billing-details">
                                    <div class="section-title">
                                        <h4 class="title">Add Categories</h4>
                                    </div>
                                    <div class="admin-form-group">
                                        <!-- ADDED: id để sau này gọi API thêm category -->
                                        <input id="category-name-input" class="input" type="text" name="manu-name" placeholder="Category Name">
                                    </div>
                                    <button class="btn-red" id="btn-add-category"><i class="fa fa-plus"></i> Add Categories</button>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <h4>Existing Brands</h4>
                        <!-- UPDATED: tbody có id, dữ liệu sẽ lấy từ API sau này -->
                        <table class="table table-bordered">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Product Count</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody id="brand-table-body">
                            <!-- ADDED: brand rows will be injected by JS (hiện tại có thể để trống hoặc fake) -->
                            </tbody>
                        </table>
                    </div>

                    <!-- TAB: ORDERS -->
                    <div id="orders" class="tab-pane fade">
                        <h3 class="section-title">Order Management</h3>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Date</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <!-- ADDED: tbody với id để sau này load Orders bằng API -->
                                <tbody id="order-table-body">
                                <!-- TODO: load orders from /api/admin/orders -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- TAB: USERS -->
                    <div id="users" class="tab-pane fade">
                        <h3 class="section-title">User Management</h3>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                                </thead>
                                <!-- ADDED: tbody với id để sau này load Users bằng API -->
                                <tbody id="user-table-body">
                                <!-- TODO: load users from /api/admin/users -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
            <!-- /MAIN CONTENT -->

        </div>
        <!-- /row -->
    </div>
    <!-- /container -->
</div>
<!-- /ADMIN SECTION -->

<!-- MODAL: ADD PRODUCT -->
<div id="addProductModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Thêm sản phẩm mới</h4>
            </div>
            <div class="modal-body">
                <!-- UPDATED: thêm id cho form & các input để lấy dữ liệu bằng JS -->
                <form id="add-product-form">
                    <div class="admin-form-group">
                        <label>Tên sản phẩm</label>
                        <input id="product-name-input" class="input" type="text" placeholder="Enter product name" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                <label>Giá tiền</label>
                                <input id="product-price-input" class="input" type="number" min="0" step="1000" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                <label>Số lượng</label>
                                <input id="product-stock-input" class="input" type="number" min="0" placeholder="0" required>
                            </div>
                        </div>
                    </div>

                    <!-- BRAND & CATEGORIES SELECTS -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                <label>Thương hiệu</label>
                                <select id="product-brand-select" class="input">
                                    <!-- TODO: có thể load từ API /api/admin/brands -->
                                    <option value="">Chọn thương hiệu</option>
                                    <option value="1">Samsung</option>
                                    <option value="2">LG</option>
                                    <option value="3">Sony</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="admin-form-group">
                                <label>Manufacturer / Category</label>
                                <select id="product-category-select" class="input">
                                    <!-- TODO: có thể load từ API /api/admin/categories -->
                                    <option value="">Chọn loại sản phẩm</option>
                                    <option value="1">Laptop</option>
                                    <option value="2">Headphone</option>
                                    <option value="3">TV</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="admin-form-group">
                        <label>Mô tả</label>
                        <textarea id="product-description-input" class="input" style="height: 100px;" placeholder="Product description..."></textarea>
                    </div>
                    <div class="admin-form-group">
                        <label>Hình ảnh sản phẩm</label>
                        <!-- ADDED: hiện tại chỉ lưu URL text (ko upload file thật) -->
                        <input id="product-image-url-input" type="text" class="input" placeholder="Image URL (optional)">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <!-- UPDATED: nút Update gọi JS addProduct() -->
                <button type="button" class="btn btn-red" id="btn-save-product">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer id="footer">
    <!-- top footer -->
    <div class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">
                <div class="col-md-3 col-xs-6">
                    <div class="footer">
                        <h3 class="footer-title">About Us</h3>
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut.</p>
                        <ul class="footer-links">
                            <li><a href="#"><i class="fa fa-map-marker"></i>1734 Stonecoal Road</a></li>
                            <li><a href="#"><i class="fa fa-phone"></i>+021-95-51-84</a></li>
                            <li><a href="#"><i class="fa fa-envelope-o"></i>email@email.com</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-3 col-xs-6">
                    <div class="footer">
                        <h3 class="footer-title">Admin Support</h3>
                        <ul class="footer-links">
                            <li><a href="#">System Health</a></li>
                            <li><a href="#">Error Logs</a></li>
                            <li><a href="#">API Documentation</a></li>
                        </ul>
                    </div>
                </div>

                <div class="clearfix visible-xs"></div>

                <div class="col-md-3 col-xs-6">
                    <div class="footer">
                        <h3 class="footer-title">Quick Links</h3>
                        <ul class="footer-links">
                            <li><a href="#">View Storefront</a></li>
                            <li><a href="#">Analytics</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-md-3 col-xs-6">
                    <div class="footer">
                        <h3 class="footer-title">Account</h3>
                        <ul class="footer-links">
                            <li><a href="#">Admin Profile</a></li>
                            <li><a href="#">Settings</a></li>
                            <li><a href="#">Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- /top footer -->

    <!-- bottom footer -->
    <div id="bottom-footer" class="section">
        <div class="container">
            <!-- row -->
            <div class="row">
                <div class="col-md-12 text-center">
							<span class="copyright">
								Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | Template by Colorlib
							</span>
                </div>
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- /bottom footer -->
</footer>
<!-- /FOOTER -->

<!-- jQuery & Bootstrap JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<!-- ADDED: JavaScript gọi API admin-service -->
<script>
    // Đổi base URL này nếu admin-service chạy port khác
    const ADMIN_API_BASE = 'http://localhost:8085/api/admin';

    // Khi trang load xong
    $(document).ready(function () {
        loadDashboardStats();
        loadProducts();

        // handle nút Save trong modal Add Product
        $('#btn-save-product').on('click', function () {
            addProduct();
        });

        // (Tạm thời) gắn alert cho nút add brand / category
        $('#btn-add-brand').on('click', function () {
            alert('TODO: gọi API POST /api/admin/brands');
        });
        $('#btn-add-category').on('click', function () {
            alert('TODO: gọi API POST /api/admin/categories');
        });
    });

    // -------- DASHBOARD --------
    function loadDashboardStats() {
        $.get(ADMIN_API_BASE + '/dashboard/overview')
            .done(function (data) {
                // data = {totalOrders, totalUsers, totalProducts, totalRevenue}
                $('#stat-orders').text(data.totalOrders);
                $('#stat-users').text(data.totalUsers);
                $('#stat-products').text(data.totalProducts);

                // Format revenue đơn giản
                const formattedRevenue = new Intl.NumberFormat('vi-VN', {
                    style: 'currency',
                    currency: 'VND'
                }).format(data.totalRevenue || 0);

                $('#stat-revenue').text(formattedRevenue);
            })
            .fail(function () {
                console.error('Failed to load dashboard stats');
            });
    }

    // -------- PRODUCTS LIST --------
    function loadProducts() {
        $.get(ADMIN_API_BASE + '/products')
            .done(function (products) {
                const $tbody = $('#product-table-body');
                $tbody.empty();

                if (!products || products.length === 0) {
                    $tbody.append(
                        '<tr><td colspan="6" class="text-center">No products found</td></tr>'
                    );
                    return;
                }

                products.forEach(function (p) {
                    const priceFormatted = new Intl.NumberFormat('vi-VN', {
                        style: 'currency',
                        currency: 'VND'
                    }).format(p.price || 0);

                    let stockLabelClass = 'label-success';
                    let stockText = 'Còn hàng';
                    if (p.stock === 0) {
                        stockLabelClass = 'label-danger';
                        stockText = 'Hết hàng';
                    } else if (p.stock < 5) {
                        stockLabelClass = 'label-warning';
                        stockText = 'Sắp hết';
                    }

                    const rowHtml = `
                        <tr>
                            <td>#${p.id}</td>
                            <td>
                                <div style="width:50px; height:50px; background:#eee; display:flex; align-items:center; justify-content:center;">
                                    ${p.imageUrl ? '<img src="' + p.imageUrl + '" style="max-width:100%; max-height:100%;" />' : '<i class="fa fa-picture-o"></i>'}
                                </div>
                            </td>
                            <td>${p.name || ''}</td>
                            <td>${priceFormatted}</td>
                            <td><span class="label ${stockLabelClass}">${stockText}</span></td>
                            <td>
                                <button class="btn btn-sm btn-default" onclick="editProduct(${p.id})"><i class="fa fa-pencil"></i></button>
                                <button class="btn btn-sm btn-danger" onclick="deleteProduct(${p.id})"><i class="fa fa-trash"></i></button>
                            </td>
                        </tr>
                    `;
                    $tbody.append(rowHtml);
                });
            })
            .fail(function () {
                console.error('Failed to load products');
            });
    }

    // -------- ADD PRODUCT --------
    function addProduct() {
        const name = $('#product-name-input').val().trim();
        const price = parseFloat($('#product-price-input').val());
        const stock = parseInt($('#product-stock-input').val(), 10);
        const brandId = $('#product-brand-select').val() || null;
        const categoryId = $('#product-category-select').val() || null;
        const description = $('#product-description-input').val().trim();
        const imageUrl = $('#product-image-url-input').val().trim();

        if (!name || isNaN(price) || isNaN(stock)) {
            alert('Vui lòng nhập đầy đủ Tên, Giá và Số lượng');
            return;
        }

        const payload = {
            name: name,
            price: price,
            stock: stock,
            brandId: brandId ? parseInt(brandId, 10) : null,
            categoryId: categoryId ? parseInt(categoryId, 10) : null,
            description: description,
            imageUrl: imageUrl
        };

        $.ajax({
            url: ADMIN_API_BASE + '/products',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            success: function () {
                $('#addProductModal').modal('hide');
                // clear form
                $('#add-product-form')[0].reset();
                // reload list
                loadProducts();
            },
            error: function () {
                alert('Thêm sản phẩm thất bại. Kiểm tra lại backend admin-service / product-service.');
            }
        });
    }

    // -------- EDIT / DELETE PRODUCT (tạm thời đơn giản) --------
    function editProduct(id) {
        alert('TODO: mở modal chỉnh sửa sản phẩm ID = ' + id);
    }

    function deleteProduct(id) {
        if (!confirm('Bạn có chắc muốn xoá sản phẩm #' + id + ' ?')) {
            return;
        }

        $.ajax({
            url: ADMIN_API_BASE + '/products/' + id,
            method: 'DELETE',
            success: function () {
                loadProducts();
            },
            error: function () {
                alert('Xoá sản phẩm thất bại. Kiểm tra lại backend.');
            }
        });
    }
</script>

</body>
</html>
